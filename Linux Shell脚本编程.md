#  Linux Shell脚本编程



## 构建基本脚本



### 创建shell脚本文件

脚本文件中，第一行指定使用的shell，`#!/bin/bash`，也可以使用其他shell运行脚本。

之后的`#`用作注释行。两个命令可以用分号放在同一行，也可以分行，shell是按照命令出现顺序执行的。

#### 脚本运行

先赋予执行权限`chmod u+x name`，然后使用单点操作符，在当前目录下使用`./name`。

#### 显示自定义消息

`echo`命令可以添加到需要显示额外消息的地方；默认不需要使用引号，若字符串中出现引号，可以使用单引号或双引号（不同于字符串中引号）划定字符串；`echo -n "string： `可以使后续命令输出紧随其后。

#### 环境变量 

用`set`命令显示完整的当前环境变量列表；使用`$`符号+变量名来显示变量内容；可以使用`\`转义该符号。

#### 用户变量

使用等号将值赋予用户变量，变量、等号、值之间不加空格，赋值时不加`$`，引用时需要加`$`，变量区分大小写。

#### 命令替换

从命令输出中提取信息，并赋给变量。使用反引号字符`，或者使用$( )格式。

### 重定向输入和输出

#### 输出重定向

`command > outputfile`将命令输出发送到指定文件中，会覆盖原有内容；

`command >> outputfile`将命令输出追加到指定文件中；

#### 输入重定向

命令总在左，重定向符号指向数据流动方向；输入重定向将文件内容重定向到命令，重定向符号为小于号`<`。例如，`wc < test`

内联输入重定向符号`<<`，需要使用一个文本标记（例如`marker`）标记输入开头和结尾。

### 管道

管道`|`被放在命令之间，将一个命令的输出重定向到另一个命令，这些命令同时执行。

`command1 | command2`

`ls -l | sort | more`

### 执行数学运算

#### 使用方括号

将一个数学运算结果赋值给某个变量时，可以使用`$[  operation ]`操作。该操作只能处理整数运算，而zsh提供了完整的浮点数运算操作。

#### bc 内建bash计算器

bash计算器实际上是一种编程语言，可以使用变量和浮点数，scale控制结果中小数位数。

在脚本中的基本用法 `variable=$(echo "options; expression" | bc)`，例如：

`var1=$(echo "scale=4; 3.4 /5" | bc)`

在脚本中也可以使用内联输入重定向，例如：

​	 var1=$(bc << marker

​	scale=4

​	a=(3 * 5)

​	b=(3*4)

​	a + b

​	marker

​	)

在bash计算器中创建的变量只在bash计算器中有效，不能用在shell脚本中。

### 退出脚本

shell中每条命令运行结束都会向shell发送一个退出状态码，是0~255之间的整数，一般用`$?`命令查看上一条执行命令的退出状态码。一个成功结束的命令的退出状态码是0，如果出错，该值为一个正数。

`exit`命令可以在脚本结束时指定一个退出状态码，例如`exit 5`

## 使用结构化命令

